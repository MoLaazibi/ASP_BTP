@page "/login"
@inject AP.BTP.MobileUI.Services.Auth.AuthService Auth

<PageTitle>Login</PageTitle>

<div class="login-page">
    <div class="brand">
        <img src="/Images/btp logo.png" alt="BTP" class="brand-logo" />
        <div class="brand-title">BTP</div>
        <div class="brand-sub">Boomkwekerij Taak Planner</div>
    </div>

    <div class="login-card">
        <div class="card-title">BTP Planning</div>

        @if (!string.IsNullOrEmpty(error))
        {
            <div class="error-text">@error</div>
        }

        <EditForm Model="model" OnValidSubmit="Submit">
            <DataAnnotationsValidator />
            <div class="field">
                <label>Email</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                    <InputText @bind-Value="model.Email" type="email" placeholder="Voer je email in" class="form-control" />
                </div>
            </div>

            <div class="field">
                <label>Wachtwoord</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-lock"></i></span>
                    <InputText @bind-Value="model.Password" type="password" placeholder="Voer je wachtwoord in" class="form-control" />
                </div>
            </div>

            <button class="btn-login" disabled="@busy">@buttonText</button>
        </EditForm>
    </div>

    <div class="login-foot">Interne tool voor boomkwekerij takenbeheer</div>
</div>

<style>
  .page, .page main, .page .content { height: 100vh; overflow: hidden; }
  .page .content { padding-top: 0; }
</style>

@code {
    private LoginModel model = new();
    private bool busy;
    private string? error;
    private string buttonText => busy ? "Even geduld..." : "Login";

    private async Task Submit()
    {
        busy = true;
        error = null;
        var (ok, err) = await Auth.LoginAsync(model.Email, model.Password);
        if (!ok)
            error = err ?? "Login mislukt";
        busy = false;
        StateHasChanged();
    }

    public class LoginModel
    {
        public string Email { get; set; } = string.Empty;
        public string Password { get; set; } = string.Empty;
    }
}
